<div style="padding-bottom: 15px;">
    <form [formGroup]="activityForm">
        <section style="position: relative;">
            <mat-card style="position: sticky; top: 0; z-index: 1000;">
                <span fxLayoutGap="20px">
                    <mat-form-field fxFlex="22" [appearance]="editMode ? 'fill' : 'outline'">
                        <mat-label>Kod</mat-label>
                        <input formControlName="code" matInput [readonly]="!editMode">
                    </mat-form-field>
                    <mat-form-field fxFlex="60" [appearance]="editMode ? 'fill' : 'outline'">
                        <mat-label>Naziv</mat-label>
                        <input formControlName="name" matInput [readonly]="!editMode">
                    </mat-form-field>
                    <span fxFlex="5" *ngIf="!editMode"></span>
                    <span fxFlex="1" *ngIf="editMode"></span>
                    <section fxLayout="column">
                        <span fxFlex="15"></span>
                        <span fxLayoutGap="10px">
                            <button mat-icon-button *ngIf="!editMode" (click)="editMode = true" color="primary">
                                <mat-icon matTooltip="Izmeni" [matTooltipPosition]="'above'">edit</mat-icon>
                            </button>
                            <button mat-icon-button *ngIf="editMode" color="primary" [disabled]="!activityForm.valid"
                                (click)="submitForm()">
                                <mat-icon matTooltip="Sačuvaj" [matTooltipPosition]="'above'">check</mat-icon>
                            </button>
                            <button mat-icon-button *ngIf="editMode" color="warn" (click)="discardChanges()">
                                <mat-icon matTooltip="Odbaci" [matTooltipPosition]="'above'">clear</mat-icon>
                            </button>
                        </span>
                    </section>
                </span>
            </mat-card>

            <div style="overflow-y: auto;">
                <h3 style="margin-bottom: 0;"><b>Opis</b></h3>
                <section fxLayoutGap="15px" style="margin-right: 15px;">
                    <cc-markdown-editor fxFlex [label]="'Opis *'" [text]="activityForm.get('guidance.description').value"
                        (textChanged)="this.activityForm.get('guidance.description').setValue($event)"
                        [editMode]="editMode"></cc-markdown-editor>
                </section>

                <h3 *ngIf="activity.examples.length !== 0" style="margin-top: 0;"><b>Primeri</b></h3>
                <div *ngFor="let example of getExamples.controls; let i = index;">
                    <mat-card fxLayout="column" style="margin-right: 15px; padding-top: 15px; margin-bottom: 15px;">
                        <div fxFlex fxLayout="row">
                            <span *ngIf="!editModes[i]"> <b>{{ getExampleControl(i, 'code').value }}: </b> </span>
                            <div *ngIf="editModes[i] || editMode">
                                <mat-form-field *ngIf="editModes[i]" fxFlex fxLayoutAlign="start center"
                                    appearance="fill">
                                    <mat-label>Kod</mat-label>
                                    <input matInput [formControl]="getExampleControl(i, 'code')"
                                        [readonly]="!editModes[i]">
                                </mat-form-field>
                            </div>
                            <div fxFlex fxLayoutAlign="end start">
                                <button mat-icon-button *ngIf="editMode && !editModes[i]" (click)="editModes[i] = true">
                                    <mat-icon>edit</mat-icon>
                                </button>
                                <button mat-icon-button *ngIf="editMode && editModes[i]"
                                    [disabled]="!activityForm.valid" (click)="updateExample(i)">
                                    <mat-icon matTooltip="Sačuvaj" [matTooltipPosition]="'above'">check</mat-icon>
                                </button>
                                <button mat-icon-button *ngIf="editMode && editModes[i]"
                                    [disabled]="!activityForm.valid" (click)="discardExampleChanges(i)">
                                    <mat-icon matTooltip="Sačuvaj" [matTooltipPosition]="'above'">clear</mat-icon>
                                </button>
                                <button mat-icon-button *ngIf="editMode" (click)="deleteExample(i)">
                                    <mat-icon>delete</mat-icon>
                                </button>
                            </div>
                        </div>
                        <div>
                            <cc-markdown-editor fxFlex [label]="'Opis *'"
                                [text]="getExampleControl(i, 'description').value"
                                (textChanged)="updateExampleDescription($event, i)" [editMode]="editModes[i]">
                            </cc-markdown-editor>
                        </div>
                    </mat-card>
                </div>

                <button *ngIf="editMode" [disabled]="!activityForm.valid" mat-raised-button color="primary" (click)="addExample()">
                    + Dodaj primer
                </button>
            </div>
        </section>
    </form>
</div>